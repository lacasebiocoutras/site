define(["jquery","lunr","moment","config-module"],function(i,n,e,t){function a(i){return String(i).replace(/&amp;/g,"&")}function c(i,n,t){var a;a=i.length>0?e(i,t):e();var c;c=n.length>0?e(n,t):e();var o=e(a).subtract(1,"days"),r=e(c).add(1,"days");return!!e().isBetween(o.format(),r.format())}function o(i){i.length?g(i):h()}var r=function(e){if(!arguments.length||null===e||void 0===e)return[];if(Array.isArray(e))return e.map(function(i){return n.utils.asString(i).toLowerCase()});var t=e.toString().trim().toLowerCase().split(n.tokenizer.seperator);return i.each(t,function(i,n){var e=n.replace(/à/gi,"a").replace(/â/gi,"a").replace(/ç/gi,"c").replace(/é/gi,"e").replace(/è/gi,"e").replace(/ê/gi,"e").replace(/î/gi,"i").replace(/ô/gi,"o").replace(/ù/gi,"u").replace(/û/gi,"u");t[i]=e}),t};n.tokenizer.registerFunction(r,"myCustomTokenizer"),window.idx=n(function(){this.pipeline.reset(),this.tokenizer(r),this.field("id"),this.field("title",{boost:10}),this.field("description"),this.field("content"),this.field("category"),this.field("tags")}),e.locale("fr");var s=" ",d="",l=d,f=["DDMMMMY"],u=null,h=function(){window.data.then(function(n){i.each(n,function(n,e){var t="#";t=t.concat(e.name_id),i(t).addClass(window.config.class_invisible_item)})}).then(function(){})},_=function(){window.data.then(function(n){i.each(n,function(n,e){var t="#";t=t.concat(e.name_id),c(e.date_debut,e.date_fin,f)?i(t).removeClass(window.config.class_invisible_item):i(t).addClass(window.config.class_invisible_item)})}).then(function(){})},w=function(n){e.locale("fr");var t="#";t=t.concat(n.name_id),c(n.date_debut,n.date_fin,f)?i(t).removeClass(window.config.class_invisible_item):i(t).addClass(window.config.class_invisible_item)},g=function(n){var e,t="#",a=!1;window.data.then(function(o){i.each(o,function(r,s){var d=s.name_id,l=!0;n.forEach(function(i){var n=i.ref,e=o[n];e.name_id===d&&(l=!1)}),e=t.concat(d),c(s.date_debut,s.date_fin,f)||(l=!0),l===!0?i(e).addClass(window.config.class_invisible_item):(i(e).removeClass(window.config.class_invisible_item),a=!0)})}).then(function(){})},m=window.location.href,v="/";window.location.pathname.indexOf(t.base_url)>-1&&(v=t.base_url);var p=v.concat(t.json_search_config),b=i.getJSON(p),x=b.then(function(n){window.config=n.config;var e=null;return i.each(n.list,function(i,n){m.indexOf(n.url)>-1&&(e=n.name,u=n.design)}),e}),C=x.then(function(i){return v.concat(i)}),y=C.then(function(n){window.data=i.getJSON(n),window.data.then(function(n){i.each(n,function(n,e){window.idx.add(i.extend({id:n},e)),w(e)})})});y.done(function(n){setTimeout(S,50,"input"),i(u.class_showall).bind("click",z),i(u.class_search).bind("click",M),i(u.id_search_box).bind("keyup",O(T))});var k=null,S=function(i){var n=u.list_items,e=document.getElementsByClassName(n);k=e[0].offsetHeight,height_px=k.toString().concat("px"),e[0].style.minHeight=height_px},z=function(){i(u.id_search_box).val(""),l=d,i(this).parents().find(u.class_search).removeClass(u.active),_()},M=function(){var n=i(this).parent().find(u.class_term_search),e=i(n).parent(),t=n.html();t=a(t),l=window.config.add_delim_categorie_search,l=l.concat(t),l=l.concat(window.config.add_delim_categorie_search),i(this).parents().find(u.class_search).removeClass(u.active),e.addClass(u.active),i(u.id_search_box).val("");var c=window.idx.search(l);o(c)},O=function(i){var n;return function(){var e=Array.prototype.slice.call(arguments),t=this;clearTimeout(n),n=setTimeout(function(){i.apply(t,e)},100)}},T=function(){var n,e=i(this).val();e===d?l===d?_():(n=window.idx.search(l),o(n)):(l!==d&&(e=e.concat(s,l)),n=window.idx.search(e),o(n))}});