define(["jquery","lunr","moment","config-module"],function(i,n,e,t){function a(i){return String(i).replace(/&amp;/g,"&")}function c(i,n){var t;t=i.length>0?e(i):e();var a;a=n.length>0?e(n):e();var c=e(t).subtract(1,"days"),o=e(a).add(1,"days");return!!e().isBetween(c.format(),o.format())}function o(i){i.length?h(i):l()}var r=function(e){if(!arguments.length||null===e||void 0===e)return[];if(Array.isArray(e))return e.map(function(i){return n.utils.asString(i).toLowerCase()});var t=e.toString().trim().toLowerCase().split(n.tokenizer.seperator);return i.each(t,function(i,n){var e=n.replace(/à/gi,"a").replace(/â/gi,"a").replace(/ç/gi,"c").replace(/é/gi,"e").replace(/è/gi,"e").replace(/ê/gi,"e").replace(/î/gi,"i").replace(/ô/gi,"o").replace(/ù/gi,"u").replace(/û/gi,"u");t[i]=e}),t};n.tokenizer.registerFunction(r,"myCustomTokenizer"),window.idx=n(function(){this.pipeline.reset(),this.tokenizer(r),this.field("id"),this.field("title",{boost:10}),this.field("description"),this.field("content"),this.field("category"),this.field("tags")});var s="",d=null,l=function(){window.data.then(function(n){i.each(n,function(n,e){var t="#";t=t.concat(e.name_id),i(t).addClass(window.config.class_invisible_item)})}).then(function(){})},f=function(){window.data.then(function(n){i.each(n,function(n,e){var t="#";t=t.concat(e.name_id),c(e.date_debut,e.date_fin)?i(t).removeClass(window.config.class_invisible_item):i(t).addClass(window.config.class_invisible_item)})}).then(function(){})},u=function(n){e.locale("fr");var t="#";t=t.concat(n.name_id),c(n.date_debut,n.date_fin)?i(t).removeClass(window.config.class_invisible_item):i(t).addClass(window.config.class_invisible_item)},h=function(n){var e,t="#",a=!1;window.data.then(function(o){i.each(o,function(r,s){var d=s.name_id,l=!0;n.forEach(function(i){var n=i.ref;o[n].name_id===d&&(l=!1)}),e=t.concat(d),c(s.date_debut,s.date_fin)||(l=!0),!0===l?i(e).addClass(window.config.class_invisible_item):(i(e).removeClass(window.config.class_invisible_item),a=!0)})}).then(function(){})},_=window.location.href,w="/";window.location.pathname.indexOf(t.base_url)>-1&&(w=t.base_url);var g=w.concat(t.json_search_config);i.getJSON(g).then(function(n){window.config=n.config;var e=null;return i.each(n.list,function(i,n){_.indexOf(n.url)>-1&&(e=n.name,d=n.design)}),e}).then(function(i){return w.concat(i)}).then(function(n){window.data=i.getJSON(n),window.data.then(function(n){i.each(n,function(n,e){window.idx.add(i.extend({id:n},e)),u(e)})})}).done(function(n){setTimeout(v,50,"input"),i(d.class_showall).bind("click",p),i(d.class_search).bind("click",b),i(d.id_search_box).bind("keyup",x(C))});var m=null,v=function(i){var n=d.list_items,e=document.getElementsByClassName(n);m=e[0].offsetHeight,height_px=m.toString().concat("px"),e[0].style.minHeight=height_px},p=function(){i(d.id_search_box).val(""),s="",i(this).parents().find(d.class_search).removeClass(d.active),f()},b=function(){var n=i(this).parent().find(d.class_term_search),e=i(n).parent(),t=n.html();t=a(t),s=window.config.add_delim_categorie_search,s=s.concat(t),s=s.concat(window.config.add_delim_categorie_search),i(this).parents().find(d.class_search).removeClass(d.active),e.addClass(d.active),i(d.id_search_box).val(""),o(window.idx.search(s))},x=function(i){var n;return function(){var e=Array.prototype.slice.call(arguments),t=this;clearTimeout(n),n=setTimeout(function(){i.apply(t,e)},100)}},C=function(){var n,e=i(this).val();""===e?""===s?f():(n=window.idx.search(s),o(n)):(""!==s&&(e=e.concat(" ",s)),n=window.idx.search(e),o(n))}});