define(["jquery","lunr","moment","config-module"],function(i,n,e,t){function a(i){return String(i).replace(/&amp;/g,"&")}function c(i,n,t){var a;a=i.length>0?e(i,t):e();var c;c=n.length>0?e(n,t):e();var o=e(a).subtract(1,"days"),r=e(c).add(1,"days");return!!e().isBetween(o.format(),r.format())}function o(i){i.length?_(i):f()}var r=function(e){if(!arguments.length||null===e||void 0===e)return[];if(Array.isArray(e))return e.map(function(i){return n.utils.asString(i).toLowerCase()});var t=e.toString().trim().toLowerCase().split(n.tokenizer.seperator);return i.each(t,function(i,n){var e=n.replace(/à/gi,"a").replace(/â/gi,"a").replace(/ç/gi,"c").replace(/é/gi,"e").replace(/è/gi,"e").replace(/ê/gi,"e").replace(/î/gi,"i").replace(/ô/gi,"o").replace(/ù/gi,"u").replace(/û/gi,"u");t[i]=e}),t};n.tokenizer.registerFunction(r,"myCustomTokenizer"),window.idx=n(function(){this.pipeline.reset(),this.tokenizer(r),this.field("id"),this.field("title",{boost:10}),this.field("description"),this.field("content"),this.field("category"),this.field("tags")}),e.locale("fr");var s="",d=["DDMMMMY"],l=null,f=function(){window.data.then(function(n){i.each(n,function(n,e){var t="#";t=t.concat(e.name_id),i(t).addClass(window.config.class_invisible_item)})}).then(function(){})},u=function(){window.data.then(function(n){i.each(n,function(n,e){var t="#";t=t.concat(e.name_id),c(e.date_debut,e.date_fin,d)?i(t).removeClass(window.config.class_invisible_item):i(t).addClass(window.config.class_invisible_item)})}).then(function(){})},h=function(n){e.locale("fr");var t="#";t=t.concat(n.name_id),c(n.date_debut,n.date_fin,d)?i(t).removeClass(window.config.class_invisible_item):i(t).addClass(window.config.class_invisible_item)},_=function(n){var e,t="#",a=!1;window.data.then(function(o){i.each(o,function(r,s){var l=s.name_id,f=!0;n.forEach(function(i){var n=i.ref;o[n].name_id===l&&(f=!1)}),e=t.concat(l),c(s.date_debut,s.date_fin,d)||(f=!0),!0===f?i(e).addClass(window.config.class_invisible_item):(i(e).removeClass(window.config.class_invisible_item),a=!0)})}).then(function(){})},w=window.location.href,g="/";window.location.pathname.indexOf(t.base_url)>-1&&(g=t.base_url);var m=g.concat(t.json_search_config);i.getJSON(m).then(function(n){window.config=n.config;var e=null;return i.each(n.list,function(i,n){w.indexOf(n.url)>-1&&(e=n.name,l=n.design)}),e}).then(function(i){return g.concat(i)}).then(function(n){window.data=i.getJSON(n),window.data.then(function(n){i.each(n,function(n,e){window.idx.add(i.extend({id:n},e)),h(e)})})}).done(function(n){setTimeout(p,50,"input"),i(l.class_showall).bind("click",b),i(l.class_search).bind("click",x),i(l.id_search_box).bind("keyup",C(y))});var v=null,p=function(i){var n=l.list_items,e=document.getElementsByClassName(n);v=e[0].offsetHeight,height_px=v.toString().concat("px"),e[0].style.minHeight=height_px},b=function(){i(l.id_search_box).val(""),s="",i(this).parents().find(l.class_search).removeClass(l.active),u()},x=function(){var n=i(this).parent().find(l.class_term_search),e=i(n).parent(),t=n.html();t=a(t),s=window.config.add_delim_categorie_search,s=s.concat(t),s=s.concat(window.config.add_delim_categorie_search),i(this).parents().find(l.class_search).removeClass(l.active),e.addClass(l.active),i(l.id_search_box).val(""),o(window.idx.search(s))},C=function(i){var n;return function(){var e=Array.prototype.slice.call(arguments),t=this;clearTimeout(n),n=setTimeout(function(){i.apply(t,e)},100)}},y=function(){var n,e=i(this).val();""===e?""===s?u():(n=window.idx.search(s),o(n)):(""!==s&&(e=e.concat(" ",s)),n=window.idx.search(e),o(n))}});